!function(t){"use strict";var n=(0,eval)("this"),e=require("criteria2IDBQuery").criteria2IDBQuery||n.criteria2IDBQuery,i=require("./SLI2Operator.js").SLI2Operator,o=require("../param/Error.js").ERROR,r=function(t,n,e){this._name=t,this._sli2_object=e,this.transaction=null,this.store=null,n&&e.db.createObjectStore(t,n),this._handling=null};r.prototype.open=function(t,n){if(this.transaction||null!==this._handling&&this._handling!==(n||""))throw o.table_already_opened(this._name,this._handling);if(this._handling!==n){var e=t||this._sli2_object.transaction||this._sli2_object.db.transaction(this._name,"readwrite");this.transaction=e,this.store=e.objectStore(this._name),this._handling=n||""}},r.prototype.tryOpen=function(t,n){return this.transaction||null!==this._handling&&this._handling!==n?!1:(this.open(t,n),!0)},r.prototype.close=function(t){if(!this.transaction||this._handling!==(t||""))throw o.table_cannot_close(this._name,this._handling,t);this.transaction=null,this.store=null,this._handling=null},r.prototype.tryClose=function(t){return this.transaction&&this._handling===(t||"")?(this.close(t),!0):!1},r.prototype.destroy=function(){this._name=null,this._sli2_object=null,this.transaction=null,this.store=null,this._handling=""},r.prototype.beginTransaction=function(t,n,e,i){var r=this,s="function"==typeof e?e:function(){},c="function"==typeof i?i:function(){};return!this.transaction&&this._handling?void c(o.invalid_state("beginTransaction")):void(this.transaction?n.call(this,function(t){s(t)},c):(this.open(null,"table_transaction"),n.call(this,function(t){r.close("table_transaction"),s(t)},function(t){r.close("table_transaction"),c(t)})))},r.prototype.create=function(t,n,e){var i=this._name,r=this._sli2_object,s="function"==typeof n?n:function(){},c="function"==typeof e?e:function(){};r.upgrade(function(n){n.objectStoreNames.contains(i)?c(o.table_already_exist(i)):r.db.createObjectStore(i,t)},s)},r.prototype.drop=function(t,n){var e=this._name,i=this._sli2_object,r="function"==typeof t?t:function(){},s="function"==typeof n?n:function(){};i.upgrade(function(t){t.objectStoreNames.contains(e)?(delete i.tables[e],i.db.deleteObjectStore(e)):s(o.table_not_exist(e))},r)},r.prototype.createIndex=function(t,n,e,i){var r=this,s=this._name,c=this._sli2_object,a="function"==typeof e?e:function(){},l="function"==typeof i?i:function(){};c.upgrade(function(e){var i=r.transaction||c.db.transaction(s),a=r.store||i.objectStore(s);if(e.objectStoreNames.contains(s)){if(!a.indexNames.contains(t))return a.createIndex(t,n);l(o.index_already_exist(t))}else l(o.table_not_exist(s))},a)},r.prototype.dropIndex=function(t,n){var e=this,i=this._name,o=this._sli2_object,r="function"==typeof n?n:function(){};o.upgrade(function(){var n=e.store,r=e.transaction;return n?n.deleteIndex(t):r?r.objectStore(i).deleteIndex(t):o.db.transaction(i).objectStore(i).deleteIndex(t)},r)},r.prototype.selectAll=function(t,n,e){var o=new i(this._sli2_object),r="function"==typeof n?n:function(){},s="function"==typeof e?e:function(){};this.beginTransaction("readwrite",function(n,e){o.selectAll(this.store,t,function(t){o.close(),n(t)},e)},r,s)},r.prototype.selectForQuery=function(t,n,o,r,s){var c=this,a=new i(this._sli2_object),l="function"==typeof r?r:function(){},u="function"==typeof s?s:function(){};this.beginTransaction("readwrite",function(i,r){for(var s=e.createQueryParameter(t,this.store),l=[],u=[],f=[],h=0,_=s.length;_>h;h+=1)l[l.length]=s[h].store,f[f.length]=s[h].filter,u[u.length]=e.createIDBKeyRange(s[h],c._sli2_object._idb_objects.IDBKeyRange);a.selectForStoresAndKeyRangesAndFilters(l,u,f,n,o,function(t){a.close(),i(t)},r)},l,u)},r.prototype.add=function(t,n,e){var o=new i(this._sli2_object),r="function"==typeof n?n:function(){},s="function"==typeof e?e:function(){};this.beginTransaction("readwrite",function(n,e){o.add(this.store,t,function(t){o.close(),n(t)},e)},r,s)},r.prototype.put=function(t,n,e){var o=new i(this._sli2_object),r="function"==typeof n?n:function(){},s="function"==typeof e?e:function(){};this.beginTransaction("readwrite",function(n,e){o.put(this.store,t,function(t){o.close(),n(t)},e)},r,s)},r.prototype.removeAll=function(t,n){var e=new i(this._sli2_object),o="function"==typeof t?t:function(){},r="function"==typeof n?n:function(){};this.beginTransaction("readwrite",function(t,n){e.deleteAll(this.store,function(n){e.close(),t(n)},n)},o,r)},r.prototype.removeForQuery=function(t,n,o){var r=this,s=new i(this._sli2_object),c="function"==typeof n?n:function(){},a="function"==typeof o?o:function(){};this.beginTransaction("readwrite",function(n,i){for(var o=e.createQueryParameter(t,this.store),c=[],a=[],l=[],u=0,f=o.length;f>u;u+=1)c[c.length]=o[u].store,l[l.length]=o[u].filter,a[a.length]=e.createIDBKeyRange(o[u],r._sli2_object._idb_objects.IDBKeyRange);s.deleteForStoresAndKeyRangesAndFilters(c,a,l,function(t){s.close(),n(t)},i)},c,a)},r.prototype.updateAll=function(t,n,e){var o=new i(this._sli2_object),r="function"==typeof n?n:function(){},s="function"==typeof e?e:function(){};this.beginTransaction("readwrite",function(n,e){o.updateAll(this.store,t,function(t){o.close(),n(t)},e)},r,s)},r.prototype.updateForQuery=function(t,n,o,r){var s=this,c=new i(this._sli2_object),a="function"==typeof o?o:function(){},l="function"==typeof r?r:function(){};this.beginTransaction("readwrite",function(i,o){for(var r=e.createQueryParameter(t,this.store),a=[],l=[],u=[],f=0,h=r.length;h>f;f+=1)a[a.length]=r[f].store,u[u.length]=r[f].filter,l[l.length]=e.createIDBKeyRange(r[f],s._sli2_object._idb_objects.IDBKeyRange);c.updateForStoresAndKeyRangesAndFilters(a,l,u,n,function(t){c.close(),i(t)},o)},a,l)},r.prototype.rollback=function(){if(!this.transaction)throw o.no_transaction(this._name);this.transaction.abort()},t.Table=r}(this);